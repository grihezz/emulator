; Вариант 9. Поиск максимума в массиве (одноадресная архитектура Фон-Неймана)
; Ожидается, что массив целых без знака расположен с адреса 300 в формате:
; [размер, элемент0, элемент1, ...]. Результат сохраняется по адресу 100.

START:
    LOAD #0          ; max = 0
    STORE 100        ; память для максимума
    STORE 101        ; индекс i = 0

    LOAD #300        ; базовый адрес массива
    STORE 102        ; указатель на размер/элементы
    LOAD (102)       ; читаем размер массива
    STORE 104        ; сохраняем размер

LOOP:
    LOAD 101         ; текущий индекс
    CMP 104          ; сравнение с размером
    JZ END           ; если i == size, завершаем работу

    LOAD 102         ; базовый адрес
    ADD #1           ; пропускаем ячейку с размером
    ADD 101          ; прибавляем индекс
    STORE 103        ; адрес текущего элемента

    LOAD (103)       ; элемент массива
    STORE 108        ; сохраняем исходное значение

    LOAD 108         ; копия элемента для сравнения
    STORE 105
    LOAD 100         ; текущий максимум
    STORE 106        ; копия максимума

    LOAD #0
    STORE 107        ; флаг "элемент больше максимума"

COMPARE_LOOP:
    LOAD 105
    JZ CHECK_MAX_DONE   ; элемент стал 0 -> элемент <= максимум

    LOAD 106
    JZ ELEMENT_GREATER  ; максимум обнулился раньше -> элемент больше

    LOAD 105
    SUB #1
    STORE 105           ; уменьшаем элемент

    LOAD 106
    SUB #1
    STORE 106           ; уменьшаем максимум

    JMP COMPARE_LOOP

CHECK_MAX_DONE:
    LOAD 106
    JZ COMPARE_END      ; оба обнулились одновременно -> равны
    JMP COMPARE_END     ; максимум ещё положительный -> элемент меньше

ELEMENT_GREATER:
    LOAD #1
    STORE 107           ; помечаем, что элемент больше
    JMP COMPARE_END

COMPARE_END:
    LOAD 107
    JZ SKIP_UPDATE

    LOAD 108            ; обновляем максимум
    STORE 100

SKIP_UPDATE:
    LOAD 101
    ADD #1
    STORE 101           ; i += 1
    JMP LOOP

END:
    HALT
