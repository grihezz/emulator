; Вариант 9. Поиск максимума в массиве (оптимизированная версия с регистрами)
; Массив целых без знака расположен с адреса 300 в формате:
; [размер, элемент0, элемент1, ...]. Результат сохраняется по адресу 100.

START:
    LOAD #0
    STORE R1         ; max = 0 (используем R1 вместо памяти)
    STORE R2         ; индекс i = 0 (используем R2 вместо памяти)
    
    LOAD #300        ; базовый адрес массива
    STORE 102        ; сохраняем в память для косвенной адресации
    STORE R3         ; также в регистр
    
    LOAD (102)       ; читаем размер через косвенную адресацию
    STORE R4         ; сохраняем размер
    STORE 110        ; также для совместимости

LOOP:
    LOAD R2          ; текущий индекс
    CMP R4           ; сравнение с размером
    JZ END           ; если i == size, завершаем работу
    
    ; Вычисляем адрес текущего элемента
    LOAD 102         ; базовый адрес из памяти
    ADD #1           ; пропускаем ячейку с размером
    ADD R2           ; прибавляем индекс
    STORE 103        ; адрес текущего элемента
    
    ; Загружаем элемент и сравниваем с максимумом
    LOAD (103)       ; элемент массива
    STORE R6         ; сохраняем элемент во временный регистр R6
    
    ; Копируем в регистры для сравнения
    LOAD R6          ; элемент для сравнения
    STORE R7         ; копия элемента
    LOAD R1          ; текущий максимум
    STORE R8         ; копия максимума
    
    LOAD #0          ; флаг сравнения
    STORE R9         ; флаг "элемент больше максимума"

COMPARE_LOOP:
    LOAD R7
    JZ CHECK_MAX_DONE   ; элемент стал 0 -> элемент <= максимум
    
    LOAD R8
    JZ ELEMENT_GREATER  ; максимум обнулился раньше -> элемент больше
    
    LOAD R7
    SUB #1
    STORE R7           ; уменьшаем элемент
    
    LOAD R8
    SUB #1
    STORE R8           ; уменьшаем максимум
    
    JMP COMPARE_LOOP

CHECK_MAX_DONE:
    LOAD R8
    JZ COMPARE_END      ; оба обнулились одновременно -> равны
    JMP COMPARE_END     ; максимум ещё положительный -> элемент меньше

ELEMENT_GREATER:
    LOAD #1
    STORE R9           ; помечаем, что элемент больше
    JMP COMPARE_END

COMPARE_END:
    LOAD R9
    JZ SKIP_UPDATE
    
    ; Обновляем максимум
    LOAD R6
    STORE R1           ; max = элемент

SKIP_UPDATE:
    LOAD R2
    ADD #1
    STORE R2           ; i += 1
    JMP LOOP

END:
    ; Сохраняем результат в память
    LOAD R1
    STORE 100
    HALT

