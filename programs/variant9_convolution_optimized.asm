; Вариант 9. Свертка двух массивов по 6 элементов (оптимизированная версия с регистрами)
; Массив A начинается с адреса 300, массив B — с адреса 320.
; Формат хранения: [размер, элемент0, элемент1, ...].
; Итоговая сумма произведений сохраняется в ячейке 100.

START:
    LOAD #0
    STORE R1         ; накопленная сумма (используем R1 вместо M[100])
    STORE R2         ; индекс i = 0 (используем R2 вместо M[101])
    
    LOAD #300
    STORE 102        ; базовый адрес массива A (сохраняем в память)
    STORE R3         ; также в регистр
    
    LOAD #320
    STORE 103        ; базовый адрес массива B (сохраняем в память)
    STORE R4         ; также в регистр
    
    LOAD (102)
    STORE R5         ; размер массива
    STORE 110        ; также для совместимости

LOOP:
    LOAD R2          ; индекс i
    CMP R5           ; сравнение с размером
    JZ END           ; если i == size, завершаем
    
    ; Вычисляем адрес A[i]
    LOAD 102         ; базовый адрес массива A из памяти
    ADD #1           ; пропускаем размер
    ADD R2           ; прибавляем индекс
    STORE 104        ; адрес A[i]
    
    LOAD (104)
    STORE R7         ; значение A[i] (используем R7)
    
    ; Вычисляем адрес B[i]
    LOAD 103         ; базовый адрес массива B из памяти
    ADD #1
    ADD R2
    STORE 105        ; адрес B[i]
    
    LOAD (105)
    STORE R9         ; значение B[i] (используем R9)
    
    ; Умножение A[i] * B[i] (используя R9 как счётчик)
    LOAD R9
    STORE R10        ; счётчик повторений (используем R10)
    LOAD #0
    STORE R11        ; произведение (используем R11)

MULT_LOOP:
    LOAD R10         ; счётчик
    JZ MULT_DONE     ; если 0, заканчиваем умножение
    
    LOAD R11         ; текущее произведение
    ADD R7           ; добавляем A[i]
    STORE R11        ; сохраняем результат
    
    LOAD R10
    SUB #1
    STORE R10        ; уменьшаем счётчик
    JMP MULT_LOOP

MULT_DONE:
    ; Добавляем произведение к сумме
    LOAD R1          ; текущая сумма
    ADD R11          ; добавляем произведение
    STORE R1         ; сохраняем новую сумму
    
    ; Увеличиваем индекс
    LOAD R2
    ADD #1
    STORE R2         ; i += 1
    JMP LOOP

END:
    ; Сохраняем результат в память
    LOAD R1
    STORE 100
    HALT

